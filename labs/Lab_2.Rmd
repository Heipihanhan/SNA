---
title: "Lab_02_QMSSG4062"
author: "Jianghanhan Li"
date: "3/21/2017"
output: html_document
---

Find a complete social network, preferably one with at least some attributes about the nodes with it. (If you simply have a social network, but no real attributes, you will need to pick an additional network to compare that first one to.)

#### 1. Describe the social network(s) to me, in terms of how it was collected, what it represents and so forth. Also give me basic topography of the network: the nature of the ties; direction of ties; overall density; and if attributes are with the network, the distribution of the categories and variables of those attributes.

This Lazega network dataset comes from a network study of corporate law partnership that was carried out in a Northeastern US corporate law firm, referred to as SG&R, 1988-1991 in New England. 

It includes (among others) measurements of networks among the 71 attorneys (partners and associates) of this firm, i.e. their strong-coworker network, advice network, friendship network, and indirect control networks. Various members' attributes are also part of the dataset, including seniority, formal status, office in which they work, gender, lawschool attended, individual performance measurements (hours worked, fees brought in), attitudes concerning various management policy options, etc.

This dataset was used to identify social processes such as bounded solidarity, lateral control, quality control, knowledge sharing, balancing powers, regulation among peers. It's directed and unweighted. 

#### 2. Calculate degree centrality (in and out degree, too, if you have such data); closeness centrality; betweenness centrality; and eigenvector centrality. Correlate those measures of centrality. Highlight which nodes are most central and least central, along different dimensions. 

```{r}
library(igraph)
```

```{r}
# import lazega network data 
test <- read.csv("~/Dropbox/Columbia_QMSS/Spring2017/Social_Network_Analysis/Data/Lazega_Friends.csv", header = TRUE, row.names = NULL, check.names = FALSE)
# turn the dataframe into a matrix
testm <- as.matrix(test)
# turn matrix into a sociomatrix
testmg <- graph.adjacency(testm, mode = "directed", weighted = NULL)
```

**Degree Centrality**
```{r}
V(testmg)$degree <- degree(testmg)
V(testmg)$degree
```
**In Degree Centrality**

```{r}
V(testmg)$degree_in <- degree(testmg, mode = c("in"), loops = TRUE, normalized = FALSE)
V(testmg)$degree_in
```

**Out Degree Centrality**
```{r}
V(testmg)$degree_out <- degree(testmg, mode = c("out"), loops = TRUE, normalized = FALSE)
V(testmg)$degree_out
```

**Closeness Centrality**
```{r}
V(testmg)$closeness <- closeness(testmg, mode = c("all"))
V(testmg)$closeness
```

**Betweenness Centrality**
```{r}
V(testmg)$betweenness <- betweenness(testmg, directed = F)
V(testmg)$betweenness
```

**Correlation of Centrality.**
```{r}
dd <- data.frame(name = V(testmg)$name)
cb <- cbind(dd, V(testmg)$degree,  V(testmg)$degree_in, V(testmg)$degree_out, V(testmg)$closeness, V(testmg)$betweenness)
head(cb)
```
From the above resutls, we see that `degree` centrality is closely related to `closenesss` centrality.

```{r}
cor(cb[, -1])
plot(cb)
```

```{r}
order(cb$`V(testmg)$degree`, decreasing = T)[1]
order(cb$`V(testmg)$degree_in`, decreasing = T)[1]
order(cb$`V(testmg)$degree_out`, decreasing = T)[1]
order(cb$`V(testmg)$closeness`, decreasing = T)[1]
order(cb$`V(testmg)$betweenness`, decreasing = T)[1]
```

```{r}
order(cb$`V(testmg)$degree`, decreasing = F)[1]
order(cb$`V(testmg)$degree_in`, decreasing = F)[1]
order(cb$`V(testmg)$degree_out`, decreasing = F)[1]
order(cb$`V(testmg)$closeness`, decreasing = F)[1]
order(cb$`V(testmg)$betweenness`, decreasing = F)[1]
```

Overall, the node 26 is the most central, and the node 44 is the least central. 

#### 3. Now, do 1 of the following, but not both: a.  If you have a network with attribute data, then state some hypothesis about how an attribute may be related to some (or all of the) measures of centrality. Explains why you think these two variables should be related. 

```{r}
# import lazega attribute data
testatt <- read.csv("~/Dropbox/Columbia_QMSS/Spring2017/Social_Network_Analysis/Data/Lazega_Attributes.csv")
```

```{r}
V(testmg)$name
V(testmg)$status <- testatt$status[match(V(testmg)$name, testatt$ID)]
V(testmg)$gender <- testatt$gender[match(V(testmg)$name, testatt$ID)]
V(testmg)$office <- testatt$office[match(V(testmg)$name, testatt$ID)]
V(testmg)$seniority <- testatt$seniority[match(V(testmg)$name, testatt$ID)]
V(testmg)$age <- testatt$age[match(V(testmg)$name, testatt$ID)]
V(testmg)$practice <- testatt$practice[match(V(testmg)$name, testatt$ID)]
V(testmg)$lawschool <- testatt$lawschool[match(V(testmg)$name, testatt$ID)]
```

```{r}
df <- cbind(cb, V(testmg)$status, V(testmg)$gender, V(testmg)$office, V(testmg)$seniority, V(testmg)$age, V(testmg)$practice, V(testmg)$lawschool)
summary(df)
```

```{r}
lm1 <- lm(V(testmg)$degree ~ V(testmg)$status + V(testmg)$gender + V(testmg)$office + V(testmg)$seniority + V(testmg)$age + V(testmg)$practice + V(testmg)$lawschool, df)
summary(lm1)
```

From the above results, we see that `degree` centrality is significantly negatively related to `status`, `office`, `age` and `practice`. 

#### 4. In either case, when you are done above, then considers alternate specifications of your variables and codings and decisions and models. What would you want to consider changing and why. If you can, report on what are the consequences of those changes?

I am going to recode `status` and `practice` for better interpretability.

```{r}
df$status_partner <- ifelse(df$`V(testmg)$status` == 1, 1, 0) # 1 partner, 0 associate
df$practice_litigation <- ifelse(df$`V(testmg)$practice` == 1, 1, 0) # 1 litigration practice, 0 corporate practice
```

Since some observations are not independent, which is an issue of using networks data to do node-level regression, I will play around with some methods to improve the results. 

**Bootstrapping**
```{r}
lm2 <- lm(V(testmg)$degree ~ status_partner + practice_litigation + V(testmg)$age, df)
summary(lm2)
```

```{r}
library(simpleboot)
boot <- lm.boot(lm2, 50)
summary(boot)
```

**Permutation**

```{r}
library(lmPerm)
perm <- lmp(V(testmg)$degree ~ status_partner + practice_litigation + V(testmg)$age, df, perm = "Prob")
summary(perm)
```

#### 5. Lastly, give your best conclusion as to what you learned from your analysis. Did it make sense, given your initial expectations? Why? Why not?

From the above results, we see that being a partner (`status` = 1) increases one's `degree` centrality by an average of 8.54 points than that of an assocaite, all else held equal. Also, practicing litigration law increases one's `degree` centrality by an average of 7.18 points than practicing corporate law, all else held equal. `age` is negatively asssociated with `degree` centrality. For lawyer A and lawyer B, where A is 1 year older than B, lawyer A is said to have 0.398 points less of `degree` centrality than lawyer B, regardless of their `status` and `practice`. 

Overall, it seems to suggest that being a young partner practing litigation law is more central at the law firm network, which makes some sense but it's also very context-dependent.



